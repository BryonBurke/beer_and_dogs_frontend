<div id="map"></div>

<script>

var dogIcon = L.icon({
  iconUrl: "<%= asset_path 'dog.svg' %>",
  iconSize:     [25, 25], // size of the icon
  iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
  popupAnchor:  [-3, -5] // point from which the popup should open relative to the iconAnchor
});

// initialize the map
var map = L.map('map').setView([45.520656, -122.677388], 13);

// load a tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{
  attribution: 'Tiles by a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  maxZoom: 17,
  minZoom: 9
}).addTo(map);



if (marker) {

} else {
  let marker;
}



</script>


      <h2>Beer/dog establishments:</h2>
      <% if @establishments %>
      <% @establishments.each do |establishment| %>
      <p><%= link_to establishment.fetch(:name), "/establishments/#{ establishment.fetch(:id) }" %></p>


      <script>

        marker = L.marker([<%= establishment.fetch(:lat) %>, <%= establishment.fetch(:long) %>], {icon: dogIcon}).addTo(map);
        marker.bindPopup('<%= link_to establishment.fetch(:name), "/establishments/#{ establishment.fetch(:id) }" %>').closePopup();

      </script>


      <% end %>

  <% else %>
  <p>Ruh roh! There are currently no dog-friendly beer stablishments that meet those search terms.</p>
  <% end %>
